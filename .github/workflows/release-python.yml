# This workflow uses actions that are not certified by GitHub.
# They are provided by a third-party and are governed by
# separate terms of service, privacy policy, and support
# documentation.

name: Create and publish Docker images

on:
  release:
    types: [published]

jobs:
  build-and-push-deps-image:
    name: Build Python Wheel package
    runs-on: ubuntu-latest
    container: ghcr.io/savoirfairelinux/opendht/opendht-deps:latest

    permissions:
      contents: read

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: cmake
        run: |
          mkdir build && cd build && \
          cmake .. -DCMAKE_INSTALL_PREFIX=/usr -DCMAKE_BUILD_TYPE=Release -DOPENDHT_C=Off -DOPENDHT_PEER_DISCOVERY=On -DOPENDHT_PYTHON=On -DOPENDHT_TOOLS=Off -DOPENDHT_PROXY_SERVER=On -DOPENDHT_PROXY_CLIENT=On

      - name: build
        run: cd build && make dist

      - uses: actions/upload-artifact@v3
        with:
          name: opendht-wheels-linux
          path: build/python/dist/*.whl
